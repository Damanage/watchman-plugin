!function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Network=0]="Network",e[e.ClientDOMReady=1]="ClientDOMReady",e[e.DOMEvent=2]="DOMEvent",e[e.DOMMutation=3]="DOMMutation",e[e.SiebelLoginData=4]="SiebelLoginData",e[e.BrowserRequestEventsAndConfig=5]="BrowserRequestEventsAndConfig"}(a||(a={})),t.default=a},,function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.EventFired=0]="EventFired",e[e.ConfigLoaded=1]="ConfigLoaded"}(a||(a={})),t.default=a},function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.DocumentNavigation=0]="DocumentNavigation",e[e.AjaxRequest=1]="AjaxRequest",e[e.AjaxRequestComplete=2]="AjaxRequestComplete",e[e.DOMEvent=3]="DOMEvent",e[e.DOMMutation=4]="DOMMutation"}(a||(a={})),t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Request=0]="Request",e[e.Response=1]="Response"}(t.AjaxRequestResponse||(t.AjaxRequestResponse={})),function(e){e[e.URL=0]="URL",e[e.Header=1]="Header",e[e.Body=2]="Body",e[e.HeaderBody=3]="HeaderBody",e[e.CustomExpression=4]="CustomExpression"}(t.AjaxTestTargetTypeEn||(t.AjaxTestTargetTypeEn={}))},function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Eval=0]="Eval",e[e.SetupDOMEventListners=1]="SetupDOMEventListners",e[e.SetupDOMMutationListners=2]="SetupDOMMutationListners",e[e.GetSiebelLoginData=3]="GetSiebelLoginData"}(a=t.ContentScriptMessageTypeEn||(t.ContentScriptMessageTypeEn={}));t.ContentScriptMessageEval=class{constructor(e,t){this.Context=e,this.Expression=t,this.MessageType=a.Eval}};t.ContentScriptMessageSetupDOMListners=class{constructor(e){this.Events=e,this.MessageType=a.SetupDOMEventListners}};t.ContentScriptMessageSetupDOMMutationListners=class{constructor(e){this.Events=e,this.MessageType=a.SetupDOMMutationListners}};t.ContentScriptMessageGetSiebelLoginData=class{constructor(){this.MessageType=a.GetSiebelLoginData}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NotStarted=0]="NotStarted",e[e.StartDone=1]="StartDone",e[e.StartCnjDone=2]="StartCnjDone",e[e.EndDone=3]="EndDone",e[e.Finished=4]="Finished"}(t.TrackOperationStateEn||(t.TrackOperationStateEn={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t={};if(e){for(var n of e.metrics||[])t[n.name]=Number(n.value);return t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debuggerEvent_requestWillBeSent="Network.requestWillBeSent",t.debuggerEvent_responseReceived="Network.responseReceived"},,function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,s){function r(e){try{u(a.next(e))}catch(e){s(e)}}function o(e){try{u(a.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(r,o)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(11),s=n(12),r=n(5),o=n(0),u=n(6),d=n(8),l=n(3),c=n(4),p=n(2),v=n(7);class h{constructor(e,t,n){this.TabId=e,this.Config=t,this.debuggerVersion="1.0",this.EventQueue=[],this.HandleEventQueueEntered=!1,this.PluginVersion=chrome.runtime.getManifest().version;this.Parent=n,this.TrackOp=new i.default(e),chrome.debugger.attach({tabId:this.TabId},this.debuggerVersion,this.OnAttach.bind(this)),chrome.debugger.sendCommand({tabId:Number(this.TabId)},"Network.enable"),chrome.runtime.onMessage.addListener(function(e,t,n){let a=this;t.tab&&a.TabId==t.tab.id&&(e.EventType==o.default.ClientDOMReady&&e.Param&&(a.Parent.SiebelLoginData=e.Param),this.EventQueue.push({EventType:e.EventType,TabId:a.TabId,EventSubType:e.EventSubtype,Param:e.DOMEvent}),a.HandleEventQueueEntered||setTimeout(a.HandleEventQueue.bind(a),1),e.EventType==o.default.ClientDOMReady&&a.SetupDOMEventListners())}.bind(this))}OnAttach(){chrome.runtime.lastError?alert(chrome.runtime.lastError.message):chrome.debugger.onEvent.addListener(this.OnDebuggerEvent.bind(this))}HandleEventQueue(){return a(this,void 0,void 0,function*(){let e=this;function t(t){return a(this,void 0,void 0,function*(){yield e.InternalEventHandler(t)})}for(e.HandleEventQueueEntered=!0;;){let n=e.EventQueue.shift();if(!n)break;yield t(n)}e.HandleEventQueueEntered=!1})}OnDebuggerEvent(e,t,n){e.tabId==this.TabId&&(this.EventQueue.push({EventType:o.default.Network,TabId:this.TabId,EventSubType:t,Request:n.request,Response:n.response,Param:n}),this.HandleEventQueueEntered||setTimeout(this.HandleEventQueue.bind(this),1))}PresentMonData(){let e=this;!function(t){let n=v.default([]);for(var a in n)e.TrackOp.PerformanceDataOnStart[a]&&(n[a]-=e.TrackOp.PerformanceDataOnStart[a]);for(var a in n)n[a]=0;let i=new Date,s=Math.pow(10,6),r=i.valueOf()-e.TrackOp.StartedOperationDate.valueOf(),o=0,u=0,d=0;for(var l in e.TrackOp.Requests){let t=e.TrackOp.Requests[l];if(t.timing){d+=null==t.requestWillBeSentTime&&t.loadingFinishedTime?t.loadingFinishedTime-t.requestReceivedTime:null==t.requestWillBeSentTime?0:t.requestReceivedTime-t.requestWillBeSentTime;const e=0;o+=t.timing.receiveHeadersEnd-Math.max(t.timing.sendEnd,t.timing.connectEnd,t.timing.dnsEnd,t.timing.proxyEnd,e),u+=t.timing.connectEnd-t.timing.connectStart+(t.timing.dnsEnd-t.timing.dnsStart)+(t.timing.sslEnd-t.timing.sslStart)}}let c=n.LayoutDuration+n.RecalcStyleDuration,p=n.ScriptDuration,h=d+u+0+c+p,f=r-h-o;f<0&&(f=0),h+=f;let m=localStorage[e.Parent.installDate_storageKey];m=m?new Date(m).valueOf():null;let g={audio_handlers:n.AudioHandlers,cpu_load:0,documents:n.Documents,dom_content_loaded:n.DomContentLoaded,duration_client_ms:h,duration_idle_ms:f,duration_loading_ms:d,duration_network_ms:u,duration_other_ms:0,duration_painting_ms:0,duration_rendering_ms:c,duration_scripting_ms:p,duration_total_ms:r,end_date:i,first_meaningful_paint:n.FirstMeaningfulPaint,frames:n.Frames,hdd_load:0,id:e.TrackOp.OpercationConfig.Id,js_event_listeners:n.JSEventListeners,js_heap_total_size:n.JSHeapTotalSize,js_heap_used_size:n.JSHeapUsedSize,layout_count:n.LayoutCount,layout_duration:n.LayoutDuration,layout_objects:n.LayoutObjects,load_size:e.TrackOp.LoadSize,media_keys:n.MediaKeys,media_key_sessions:n.MediaKeySessions,message_log:"",navigation_start:n.NavigationStart,nodes:n.Nodes,pausable_objects:n.PausableObjects,plugin_update_date:m,plugin_version:e.PluginVersion,ram_load_per:0,ram_load_value:0,recalc_style_count:n.RecalcStyleCount,recalc_style_duration:n.RecalcStyleDuration,request_count:e.TrackOp.RequestNum,request_num_failed:e.TrackOp.RequestNumFailed,request_num_from_cache:e.TrackOp.RequestNumFromCache,resources:n.Resources,script_duration:n.ScriptDuration,script_promises:n.ScriptPromises,server_time:o,start_date:e.TrackOp.StartedOperationDate,task_duration:i.valueOf()-e.TrackOp.StartedOperationDate.valueOf(),timestamp:n.Timestamp,uacss_resources:n.UACSSResources,v8_per_context_datas:n.V8PerContextDatas,worker_global_scopes:n.WorkerGlobalScopes};for(var E in g)if(g[E]){let e=Number(g[E]);isNaN(e)||(e=Math.round(e*s)/s,g[E]=e)}console.log("operation completed",g);let T=Object.assign({Region:"",RegionCode:"",BranchId:"",BranchName:"",DivisionCode:"",LoginName:"",DivisionName:""},e.Parent.SiebelLoginData);e.Parent.LogEvent(e.TabId,"op",$.extend(g,{region:T.Region,region_code:T.RegionCode,branch_id:T.BranchId,branch_name:T.BranchName,division_code:T.DivisionCode,division_name:T.DivisionName}))}()}isSiebelLoginMatch(e,t){if(e.DivisionCode&&(t.tpList||[]).includes(e.DivisionCode))return!0;function n(n,a){return!(t[a]||[]).length||t[a].includes(e[n])}return n("RegionCode","regionList")&&n("BranchId","filialList")}InternalEventHandler(e){return a(this,void 0,void 0,function*(){let t=this;if(this.TrackOp.State!=u.TrackOperationStateEn.NotStarted)return yield this.TrackOp.HandleEvent(e,this.TrackOp.OpercationConfig),void(this.TrackOp.State==u.TrackOperationStateEn.Finished&&(this.PresentMonData(),this.TrackOp.State=u.TrackOperationStateEn.NotStarted));for(var n of this.Config.Operations){let a=new Date,i=null;if(n.EffectiveDateTo&&(i=n.EffectiveDateTo).setDate(i.getDate()+1),n.IsActive&&(!n.EffectiveDateFrom||a>=n.EffectiveDateFrom)&&(!n.EffectiveDateTo||a<i)&&(!t.Parent.SiebelLoginData||!n.SiebelLoginDataFilter||t.isSiebelLoginMatch(t.Parent.SiebelLoginData,n.SiebelLoginDataFilter))&&(yield this.TrackOp.HandleEvent(e,n))!=u.TrackOperationStateEn.NotStarted)break}})}SetupDOMEventListners(){let e=[],t=[];function n(n){n&&n.EventType==l.default.DOMEvent?e.push(n):n&&n.EventType==l.default.DOMMutation&&t.push(n)}for(let e in this.Config.Operations)this.Config.Operations[e].IsActive&&(n(this.Config.Operations[e].StartEvent),this.Config.Operations[e].StartEvent&&n(this.Config.Operations[e].StartEvent.CnjEndEvent),n(this.Config.Operations[e].EndEvent));chrome.tabs.sendMessage(this.TabId,new r.ContentScriptMessageSetupDOMListners(e)),chrome.tabs.sendMessage(this.TabId,new r.ContentScriptMessageSetupDOMMutationListners(t))}}let f=1;class m{constructor(e){this.URLPattern=e,this.EventType=l.default.DocumentNavigation,this.EventConfigurationId=f++,this.CnjEndEvent=new E("DOMContentLoaded")}TestMatchInternal(e){return a(this,void 0,void 0,function*(){return e.EventType==o.default.Network&&e.EventSubType==d.debuggerEvent_requestWillBeSent&&e.Param&&"Document"==e.Param.type&&e.Request&&new RegExp(this.URLPattern,"i").test(e.Request.url)})}}class g{constructor(){this.EventType=l.default.AjaxRequest,this.EventConfigurationId=f++}TestMatchInternal(e){return a(this,void 0,void 0,function*(){let t=e.EventType==o.default.Network&&(this.RequestResponse==c.AjaxRequestResponse.Request&&e.EventSubType==d.debuggerEvent_requestWillBeSent||this.RequestResponse==c.AjaxRequestResponse.Response&&e.EventSubType==d.debuggerEvent_responseReceived)&&e.Param&&"XHR"==e.Param.type;if(e.Param=e.Param||{},!t)return!1;let n=new RegExp(this.OKRegexp,"i"),i=e.Param[this.RequestResponse==c.AjaxRequestResponse.Request?"request":"response"];if(!i)return;if(this.RequestResponse==c.AjaxRequestResponse.Request){let e=[];for(var s in i.headers)e.push(s+": "+i.headers[s]);i.headersText=e.join("\r\n")}let r=this;if(this.TestTarget==c.AjaxTestTargetTypeEn.URL){return n.test(i.url)}if(this.TestTarget==c.AjaxTestTargetTypeEn.Header){return n.test(i.headersText)}return r.RequestResponse==c.AjaxRequestResponse.Request&&[c.AjaxTestTargetTypeEn.HeaderBody,c.AjaxTestTargetTypeEn.Body].indexOf(this.TestTarget)>=0?new Promise(function(t){chrome.debugger.sendCommand({tabId:e.TabId},"Network.getRequestPostData",{requestId:e.Param.requestId},function(e){return a(this,void 0,void 0,function*(){let a=chrome.runtime.lastError?"":e.postData;r.TestTarget==c.AjaxTestTargetTypeEn.HeaderBody&&(a=i.headersText+a);let s=n.test(a);t(s)})})}):r.RequestResponse==c.AjaxRequestResponse.Response&&[c.AjaxTestTargetTypeEn.HeaderBody,c.AjaxTestTargetTypeEn.Body].indexOf(this.TestTarget)>=0&&new Promise(t=>{chrome.debugger.sendCommand({tabId:e.TabId},"Network.getResponseBody",{requestId:e.Param.requestId},function(i){return a(this,void 0,void 0,function*(){let a=i.body;r.TestTarget==c.AjaxTestTargetTypeEn.HeaderBody&&(a=e.Param.response.headersText+a);let s=n.test(a);t(s)})})})})}}class E{constructor(e,t){this.DOMEvent=e,this.TargetElementSelector=t,this.EventType=l.default.DOMEvent,this.EventConfigurationId=f++}TestMatchInternal(e){return a(this,void 0,void 0,function*(){return e.EventType==o.default.ClientDOMReady&&"DOMContentLoaded"==this.DOMEvent||e.EventType==o.default.DOMEvent&&e.EventSubType==this.DOMEvent&&e.Param.EventConfigurationId==this.EventConfigurationId})}}t.EventConfigurationDOMEvent=E;class T{constructor(e,t){this.TargetElementSelector=e,this.OKExpression=t,this.EventType=l.default.DOMMutation,this.EventConfigurationId=f++}TestMatchInternal(e){return a(this,void 0,void 0,function*(){return e.EventType==o.default.DOMMutation})}}t.EventConfigurationDOMMutation=T;window.monitoringBackground=new class{constructor(e){var t;this.attachedToTabIds=[],this.TabHandlers=[],this.OperationsConfig={SiebelURL:null,Operations:[]},this.PreConfig={SiebelURL:"http://bcvm327/fins_rus/",Operations:[{Id:"1",OperationName:"1",URLPattern:"http://localhost:8080/.*",StartEvent:new m("http://localhost:8080/?$"),IsActive:!0,SiebelLoginDataFilter:null},{Id:"2",OperationName:"2",URLPattern:"http://localhost:8080/.*",StartEvent:(t=new g,t.RequestResponse=c.AjaxRequestResponse.Request,t.TestTarget=c.AjaxTestTargetTypeEn.URL,t.OKRegexp="http://localhost:8080/MessageHub/PendingActivities",t),IsActive:!0,SiebelLoginDataFilter:null},{Id:"3",OperationName:"3",URLPattern:"http://localhost:8080/.*",StartEvent:new E("click","a[href='/Admin/EditUserRights/1']"),IsActive:!0,SiebelLoginDataFilter:null},{Id:"4",OperationName:"4",URLPattern:"http://localhost:8080/.*",StartEvent:new T("table"),IsActive:!0,SiebelLoginDataFilter:null},{Id:"5",OperationName:"5",URLPattern:"http://localhost:8080/.*",StartEvent:(()=>{var e=new g;return e.TestTarget=c.AjaxTestTargetTypeEn.URL,e.OKRegexp="PendingActivities",e.RequestResponse=c.AjaxRequestResponse.Request,e})(),IsActive:!0,SiebelLoginDataFilter:null}]},this.AccumulatedEvents=[],this.CollectedEvents=[],this.browserActionTabIds=[],this.siebelDataSent=!1,this.installDate_storageKey="installDate";var n=this,i=e+"API/",s=i+"LogEvent/",r=i+"SiebelLoginData/";let u=i+"getConfig",d=i+"getConfigImm";var v={type:"post",xhrFields:{withCredentials:!0},crossDomain:!0};setInterval(function(){if(n.AccumulatedEvents.length){var e=n.AccumulatedEvents;n.AccumulatedEvents=[],$.ajax(Object.assign({url:s,data:{p:{items:e}}},v))}},1e3);let h=!0;function f(){chrome.runtime.sendMessage({eventType:p.default.ConfigLoaded,eventParam:n.OperationsConfig})}!function(){a(this,void 0,void 0,function*(){function e(){return a(this,void 0,void 0,function*(){return new Promise(function(e){$.ajax(Object.assign({url:h?d:u},v,{timeout:0})).done(function(t){console.log("%cConfiguration received >>>>>>>>>>>>>>>>>>>>>>>>>>","color:#000;background-color:#ccc;"),h=!1,function(e){if(e.config&&e.config.configJson){var t=JSON.parse(e.config.configJson).config.find(function(e){return"efr_home_regx"==e.param_code});t&&(n.OperationsConfig.SiebelURL=t.value)}if(!e)return;let a={};a.ajax=l.default.AjaxRequest,a["dom-mutation"]=l.default.DOMMutation,a.doc=l.default.DocumentNavigation,a.event=l.default.DOMEvent,e.operations&&(n.OperationsConfig.Operations=e.operations.map(function(e){let t=JSON.parse(e.configData);function n(e){let n;switch(a[t[e+"_type"]]){case l.default.AjaxRequest:let i=new g;i.RequestResponse=t[e+"_subtype"]==c.AjaxRequestResponse.Request?c.AjaxRequestResponse.Request:c.AjaxRequestResponse.Response,i.TestTarget=Number(t[e+"_monitor"]),i.OKRegexp=t[e+"_regexp"],i.CustomExpression=t[e+"_cond"],n=i,i.RequestResponse,c.AjaxRequestResponse.Request;break;case l.default.DOMMutation:n=new T(t[e+"_regexp"],t[e+"_cond"]);break;case l.default.DocumentNavigation:n=new m(t[e+"_monitor"]);break;case l.default.DOMEvent:let s=new E(t[e+"_subtype"],t[e+"_regexp"]);s.OKExpression=t[e+"_cond"],n=s;break;default:n=null}return null!=n&&(n.RepeatCount=t[e+"_events_count"]),n}return console.log(t),{EffectiveDateFrom:"string"==typeof t.date_from?new Date(t.date_from):t.date_from,EffectiveDateTo:"string"==typeof t.date_to?new Date(t.date_to):t.date_to,EndEvent:n("stop"),Id:t.id,IsActive:t.active,OperationName:t.operation_name,StartEvent:n("start"),URLPattern:t.browser_link,SiebelLoginDataFilter:{regionList:t.regionList,filialList:t.filialList,tpList:t.tpList}}})),n.attachToAllTabs()}(t),f(),e()}).fail(function(){setTimeout(function(){e()},1e4)})})})}for(;;)yield e()})}(),n.attachToAllTabs(),chrome.tabs.onUpdated.addListener(function(e,t,a){t.url&&n.AttachToTab(a)}),chrome.tabs.onRemoved.addListener(function(e){let t=n.browserActionTabIds.indexOf(e);t>=0&&n.browserActionTabIds.splice(t,1)}),chrome.runtime.onMessage.addListener(function(e,t,a){e.EventType==o.default.SiebelLoginData?(console.log("SiebelLoginData:",e.Param),e.Param&&!n.SiebelLoginData&&(n.SiebelLoginData=e.Param),$.ajax(Object.assign({url:r,data:e.Param},v))):e.EventType==o.default.BrowserRequestEventsAndConfig&&(a({collectedEvents:n.CollectedEvents}),setTimeout(f,0))}.bind(this)),chrome.browserAction.onClicked.addListener(function(e){chrome.tabs.create({url:chrome.runtime.getURL("index.html")},function(e){n.browserActionTabIds.push(e.id)})}),chrome.runtime.onInstalled.addListener(function(e){["install","update"].includes(e.reason)&&window.localStorage.setItem(n.installDate_storageKey,JSON.stringify(new Date))})}HandleInternalEvent(e){}LogEvent(e,t,n){let a=this;chrome.tabs.query({},function(i){var r=i.filter(function(t){return t.id==e});let o={title:"",url:"",timestamp:(new Date).valueOf(),timeZoneOffset:(new Date).getTimezoneOffset()};r.length&&(o.tabTitle=r[0].title,o.tabUrl=r[0].url),n||(n={});let u=Object.assign({tabId:e,message:t,param:n},o);var d=a.OperationsConfig.Operations.filter(function(e){return e.Id==u.param.id}),l=Object.assign({},u);d.length&&(l.operationName=d[0].OperationName),l.param.start_date=l.param.start_date.valueOf(),l.param.end_date=l.param.end_date.valueOf(),a.CollectedEvents.push(l),a.browserActionTabIds.forEach(e=>chrome.tabs.sendMessage(e,new s.default(p.default.EventFired,a.CollectedEvents))),u.param=JSON.stringify(n),a.AccumulatedEvents.push(u)})}GetSiebelLoginData(e){chrome.tabs.sendMessage(e,new r.ContentScriptMessageGetSiebelLoginData)}AttachToTab(e){let t=this;var n=Number(e.id);!t.TabHandlers.some(function(e){return e.TabId==n})&&e.url&&!e.url.toLowerCase().startsWith("chrome://")&&this.OperationsConfig.Operations.some(function(t){return new RegExp(t.URLPattern,"i").test(e.url)})&&t.TabHandlers.push(new h(n,t.OperationsConfig,t)),!t.siebelDataSent&&new RegExp(t.OperationsConfig.SiebelURL,"i").test(e.url)&&t.GetSiebelLoginData(n)}attachToAllTabs(){let e=this;chrome.tabs.query({},function(t){t.forEach(function(t){e.AttachToTab(t)})})}}("http://localhost:5002/")},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,s){function r(e){try{u(a.next(e))}catch(e){s(e)}}function o(e){try{u(a.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(r,o)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(6),s=n(0),r=n(7),o=n(8);t.default=class{constructor(e){this.TabId=e,this.State=i.TrackOperationStateEn.NotStarted,this.State=i.TrackOperationStateEn.NotStarted,this.ResetCounters();let t=this;this.StateTable=[],this.StateTable[i.TrackOperationStateEn.NotStarted]=((e,n)=>a(this,void 0,void 0,function*(){return n.StartEvent&&(yield n.StartEvent.TestMatchInternal(e,this.RequestId))?(t.OpercationConfig=n,t.RequestId=e.Param?e.Param.requestId:null,t.PerformanceDataOnStart=r.default(null),t.StartedOperationDate=new Date,i.TrackOperationStateEn.StartDone):t.State})),this.StateTable[i.TrackOperationStateEn.Finished]=this.StateTable[i.TrackOperationStateEn.NotStarted],this.StateTable[i.TrackOperationStateEn.StartDone]=((e,n)=>a(this,void 0,void 0,function*(){return n.StartEvent&&n.StartEvent.CnjEndEvent?(yield n.StartEvent.CnjEndEvent.TestMatchInternal(e,this.RequestId))?i.TrackOperationStateEn.StartCnjDone:i.TrackOperationStateEn.StartDone:n.EndEvent?(yield n.EndEvent.TestMatchInternal(e,this.RequestId))?n.EndEvent.CnjEndEvent?(t.RequestId=e.Param?e.Param.requestId:null,i.TrackOperationStateEn.EndDone):i.TrackOperationStateEn.Finished:t.State:i.TrackOperationStateEn.Finished})),this.StateTable[i.TrackOperationStateEn.StartCnjDone]=((e,n)=>a(this,void 0,void 0,function*(){return n.EndEvent?(yield n.EndEvent.TestMatchInternal(e,this.RequestId))?n.EndEvent.CnjEndEvent?(t.RequestId=e.Param?e.Param.requestId:null,i.TrackOperationStateEn.EndDone):i.TrackOperationStateEn.Finished:t.State:i.TrackOperationStateEn.Finished})),this.StateTable[i.TrackOperationStateEn.EndDone]=((e,n)=>a(this,void 0,void 0,function*(){return(yield n.EndEvent.CnjEndEvent.TestMatchInternal(e,this.RequestId))?i.TrackOperationStateEn.Finished:t.State}))}ResetCounters(){this.LoadSize=0,this.RequestNum=0,this.RequestNumFailed=0,this.RequestNumFromCache=0,this.Requests=[]}HandleEvent(e,t){return a(this,void 0,void 0,function*(){let n=this,a=yield this.StateTable[this.State](e,t);if(a!=i.TrackOperationStateEn.NotStarted&&this.State!=i.TrackOperationStateEn.NotStarted){let t=[{ie:{EventType:s.default.Network,TabId:this.TabId,EventSubType:"Network.loadingFinished"},handler:e=>{n.LoadSize+=Number(e.Param.encodedDataLength),n.RequestNum++}},{ie:{EventType:s.default.Network,TabId:this.TabId,EventSubType:o.debuggerEvent_requestWillBeSent},handler:e=>{n.Requests[e.Param.requestId]={requestId:e.Param.requestId,requestWillBeSentTime:e.Param.timestamp,timing:null,requestReceivedTime:null,request:e.Request}}},{ie:{EventType:s.default.Network,TabId:this.TabId,EventSubType:o.debuggerEvent_responseReceived},handler:e=>{n.RequestNumFailed+="200"==e.Param.response.status||"304"==e.Param.response.status?0:1,n.RequestNumFromCache+=e.Param.response.fromDiskCache||"304"==e.Param.response.status?1:0;let t=n.Requests[e.Param.requestId];t||(t={requestId:e.Param.requestId,requestWillBeSentTime:null,timing:null,requestReceivedTime:null,request:e.Request},n.Requests[e.Param.requestId]=t),t.requestReceivedTime=e.Param.timestamp,t.timing=e.Param.response.timing}},{ie:{EventType:s.default.Network,TabId:this.TabId,EventSubType:"Network.loadingFinished"},handler:e=>{let t=n.Requests[e.Param.requestId];t||(t={requestId:e.Param.requestId,requestWillBeSentTime:null,timing:null,requestReceivedTime:null,request:null},n.Requests[e.Param.requestId]=t),t.loadingFinishedTime=e.Param.timestamp}},{ie:{EventType:s.default.Network,TabId:this.TabId,EventSubType:"Network.dataReceived"},handler:e=>{let t=n.Requests[e.Param.requestId];t||(t={requestId:e.Param.requestId,requestWillBeSentTime:null,timing:null,requestReceivedTime:null,request:null},n.Requests[e.Param.requestId]=t)}}];for(var r of t)r.ie.EventType==e.EventType&&r.ie.EventSubType==e.EventSubType&&r.handler(e)}return a!=n.State&&this.State==i.TrackOperationStateEn.NotStarted&&this.ResetCounters(),a!=n.State&&console.log("Switched state for op:",t.Id," new state:",i.TrackOperationStateEn[a]),this.State=a,a})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t){this.eventType=e,this.eventParam=t}}}]);